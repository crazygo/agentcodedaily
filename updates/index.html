<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Daily - Weekly Report</title>
    <link rel="stylesheet" href="assets/base.css">
    <style>
        /* Medium Style Overrides */
        :root {
            --bg-color: #FFFFFF;
            --text-primary: #000000;
            --text-secondary: #292929;
            --text-muted: #6B6B6B;
            --border-color: #E6E6E6;
            --card-bg: #FFFFFF;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            color: var(--text-secondary);
            background-color: var(--bg-color);
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            line-height: 1.6;
        }

        /* Container */
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Global Site Header */
        .global-header {
            text-align: center;
            margin-bottom: 60px;
            padding-bottom: 40px;
        }

        .site-title {
            font-family: 'Merriweather', 'Georgia', 'Times New Roman', serif;
            font-size: 3rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 12px;
            letter-spacing: -0.5px;
        }

        .tagline {
            font-size: 1rem;
            color: var(--text-muted);
            margin-bottom: 24px;
            font-weight: 400;
        }

        .github-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--text-muted);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.2s ease;
        }

        .github-link:hover {
            color: var(--text-primary);
            text-decoration: none;
        }

        /* Two-Column Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 60px;
            align-items: start;
        }

        /* Sidebar */
        .sidebar {
            position: sticky;
            top: 40px;
        }

        .timeline-nav {
            font-size: 0.9rem;
        }

        .current-period {
            padding: 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--card-bg);
        }

        .current-period.active {
            border-color: var(--text-primary);
        }

        .period-label {
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 8px;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .period-dates {
            color: var(--text-secondary);
            font-weight: 400;
        }

        /* Main Content */
        .main-content {
            flex: 1;
        }

        /* Weekly Header */
        .weekly-header {
            margin-bottom: 48px;
        }

        .weekly-title {
            font-family: 'Merriweather', 'Georgia', 'Times New Roman', serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 12px;
            line-height: 1.2;
        }

        .weekly-subtitle {
            font-size: 1.1rem;
            color: var(--text-muted);
            margin-bottom: 16px;
            font-weight: 400;
        }

        .weekly-description {
            font-size: 1rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Category Sections */
        .category-section {
            margin-bottom: 56px;
        }

        .category-title {
            font-family: 'Merriweather', 'Georgia', 'Times New Roman', serif;
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 24px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 12px;
        }

        /* Scroll Grid System */
        .scroll-grid {
            display: grid;
            grid-auto-flow: column;
            grid-auto-columns: 320px;
            gap: 20px;
            overflow-x: auto;
            padding-bottom: 15px;
        }

        .scroll-grid::-webkit-scrollbar {
            height: 6px;
        }

        .scroll-grid::-webkit-scrollbar-track {
            background: var(--border-color);
            border-radius: 3px;
        }

        .scroll-grid::-webkit-scrollbar-thumb {
            background: var(--text-muted);
            border-radius: 3px;
        }

        .scroll-grid::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        .grid-rows-1 {
            grid-template-rows: auto;
        }

        .grid-rows-2 {
            grid-template-rows: repeat(2, auto);
        }

        .grid-rows-3 {
            grid-template-rows: repeat(3, auto);
        }

        /* Cards */
        .card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .card:hover {
            border-color: var(--text-muted);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .card-title {
            margin-bottom: 12px;
            line-height: 1.3;
        }

        .card-title a {
            font-family: 'Merriweather', 'Georgia', 'Times New Roman', serif;
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--text-primary);
            text-decoration: none;
        }

        .card-title a:hover {
            text-decoration: underline;
        }

        .card-description {
            font-size: 0.95rem;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 16px;
            flex-grow: 1;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .card-metadata {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: var(--text-muted);
            border-top: 1px solid var(--border-color);
            padding-top: 12px;
        }

        .card-date {
            font-weight: 500;
        }

        .card-source {
            text-transform: lowercase;
        }

        /* Loading and Error States */
        .loading, .error, .no-data {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
            font-size: 1.1rem;
        }

        /* Responsive Design */
        @media (max-width: 968px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 40px;
            }

            .sidebar {
                position: static;
            }

            .timeline-nav {
                margin-bottom: 32px;
            }
        }

        @media (max-width: 640px) {
            body {
                padding: 20px 16px;
            }

            .site-title {
                font-size: 2.25rem;
            }

            .weekly-title {
                font-size: 2rem;
            }

            .scroll-grid {
                grid-auto-columns: 280px;
                gap: 16px;
            }

            .card {
                padding: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Global Site Header -->
        <header class="global-header">
            <h1 class="site-title">Agent Daily</h1>
            <p class="tagline">Build your own daily with AI</p>
            <a href="https://github.com/crazygo/agentdaily" target="_blank" class="github-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path>
                </svg>
                View on GitHub
            </a>
        </header>

        <!-- Two-Column Layout -->
        <div class="main-layout">
            <!-- Left Sidebar -->
            <aside class="sidebar">
                <nav class="timeline-nav">
                    <div class="current-period active">
                        <div class="period-label">Current Week</div>
                        <div class="period-dates" id="current-dates">Loading...</div>
                    </div>
                </nav>
            </aside>

            <!-- Right Column Main Content -->
            <main class="main-content">
                <header class="weekly-header">
                    <h2 class="weekly-title">Weekly Report</h2>
                    <p class="weekly-subtitle" id="weekly-dates">Loading...</p>
                    <p class="weekly-description">A curated summary of the most important updates in AI from the last 7 days.</p>
                </header>

                <div id="categories-container">
                    <div class="loading">Loading weekly insights...</div>
                </div>
            </main>
        </div>
    </div>

    <script src="assets/base.js"></script>
    <script>
        // Weekly Report Generation Logic
        class WeeklyReportGenerator {
            constructor() {
                this.categories = {
                    'New Products': [],
                    'New Features': [],
                    'New Technologies': [],
                    'Others': []
                };
                this.dates = [];
                this.manifest = null;
            }

            async init() {
                try {
                    await this.loadManifest();
                    await this.loadData();
                    this.render();
                } catch (error) {
                    console.error('Error generating weekly report:', error);
                    document.getElementById('categories-container').innerHTML =
                        '<div class="error">Error loading weekly report. Please try again later.</div>';
                }
            }

            async loadManifest() {
                try {
                    const response = await fetch('manifest.json');
                    this.manifest = await response.json();
                    this.determineDateRange();
                } catch (error) {
                    throw new Error('Failed to load manifest');
                }
            }

            determineDateRange() {
                if (!this.manifest || !this.manifest.days.length) {
                    throw new Error('No data in manifest');
                }

                // Find the latest date
                const sortedDates = [...this.manifest.days].sort((a, b) =>
                    new Date(b.date) - new Date(a.date)
                );

                const latestDate = new Date(sortedDates[0].date);
                const endDate = latestDate;
                const startDate = new Date(endDate);
                startDate.setDate(startDate.getDate() - 6); // 7 days total

                // Filter for the 7-day window
                this.dates = sortedDates.filter(item => {
                    const itemDate = new Date(item.date);
                    return itemDate >= startDate && itemDate <= endDate;
                });

                this.startDate = startDate;
                this.endDate = endDate;
            }

            async loadData() {
                const allItems = new Map(); // Use Map for deduplication

                for (const dateItem of this.dates) {
                    const datePath = dateItem.date;

                    try {
                        // Get all JSON files in the date folder
                        const jsonFiles = await this.getJsonFiles(datePath);

                        for (const filename of jsonFiles) {
                            try {
                                const response = await fetch(`${datePath}/${filename}`);
                                const data = await response.json();

                                // Process different JSON structures
                                this.processDataFile(data, allItems, dateItem.date);
                            } catch (fileError) {
                                console.warn(`Failed to load ${filename}:`, fileError);
                            }
                        }
                    } catch (folderError) {
                        console.warn(`Failed to load data from ${datePath}:`, folderError);
                    }
                }

                // Categorize all unique items
                allItems.forEach(item => {
                    const category = this.categorizeItem(item);
                    this.categories[category].push(item);
                });
            }

            async getJsonFiles(datePath) {
                // Check manifest for available files
                const dateManifest = this.manifest.days.find(d => d.date === datePath);
                if (dateManifest && dateManifest.files) {
                    return dateManifest.files.filter(file => file.endsWith('.json'));
                }

                // Fallback to common names
                const commonNames = ['data.json', 'items.json', 'content.json', 'daily.json', 'news.json'];
                const foundFiles = [];

                for (const name of commonNames) {
                    try {
                        const response = await fetch(`${datePath}/${name}`);
                        if (response.ok) {
                            foundFiles.push(name);
                        }
                    } catch {
                        // File doesn't exist, continue
                    }
                }

                return foundFiles.length > 0 ? foundFiles : ['data.json'];
            }

            processDataFile(data, allItems, collectionDate) {
                // Handle different JSON structures
                let items = [];

                if (data.newProducts && Array.isArray(data.newProducts)) {
                    items.push(...data.newProducts);
                }

                if (data.whitelistUpdates && Array.isArray(data.whitelistUpdates)) {
                    items.push(...data.whitelistUpdates);
                }

                if (data.insights && Array.isArray(data.insights)) {
                    items.push(...data.insights);
                }

                if (data.items && Array.isArray(data.items)) {
                    items.push(...data.items);
                }

                if (Array.isArray(data)) {
                    items.push(...data);
                }

                // Add to allItems with deduplication
                items.forEach(item => {
                    const key = this.getUniqueKey(item);
                    if (key) {
                        allItems.set(key, {
                            ...item,
                            collectionDate: collectionDate
                        });
                    }
                });
            }

            getUniqueKey(item) {
                // Try to find a unique identifier
                const url = item.url || item.href || item.link || item.source_url;
                const title = item.title || item.name || item.headline;

                if (url) return url;
                if (title) return title.toLowerCase().trim();
                return null;
            }

            categorizeItem(item) {
                const title = (item.title || item.name || item.headline || '').toLowerCase();
                const description = (item.description || item.summary || item.content || item.text || '').toLowerCase();
                const content = `${title} ${description}`;

                // New Products - complete new tools, apps, or agents
                if (content.includes('launch') || content.includes('new app') || content.includes('new tool') ||
                    content.includes('introducing') || content.includes('presents') || content.includes('announces') ||
                    content.includes('startup') || content.includes('product launch') || content.includes('new platform') ||
                    (content.includes('ai') && (content.includes('assistant') || content.includes('agent') || content.includes('chatbot'))) ||
                    content.includes('open-source') && content.includes('tool') ||
                    content.includes('product hunt')) {
                    return 'New Products';
                }

                // New Features - updates to existing tools, improvements, v2.0 releases
                if (content.includes('update') || content.includes('feature') || content.includes('improvement') ||
                    content.includes('upgrade') || content.includes('enhancement') || content.includes('v2') ||
                    content.includes('version 2') || content.includes('new feature') || content.includes('beta') ||
                    content.includes('redesign') || content.includes('refresh') || content.includes('revamp') ||
                    content.includes('whitelist') || content.includes('pro')) {
                    return 'New Features';
                }

                // New Technologies - papers, underlying models, frameworks, research
                if (content.includes('research') || content.includes('paper') || content.includes('model') ||
                    content.includes('framework') || content.includes('algorithm') || content.includes('technology') ||
                    content.includes('innovation') || content.includes('breakthrough') || content.includes('scientific') ||
                    content.includes('study') || content.includes('findings') || content.includes('open source') ||
                    content.includes('benchmark') || content.includes('evaluation') || content.includes('metrics')) {
                    return 'New Technologies';
                }

                // Others - general news, industry commentary, miscellaneous
                return 'Others';
            }

            formatDate(dateString) {
                const date = new Date(dateString);
                const options = { month: 'short', day: 'numeric', year: 'numeric' };
                return date.toLocaleDateString('en-US', options);
            }

            formatDateRange() {
                const options = { month: 'short', day: 'numeric' };
                return `${this.startDate.toLocaleDateString('en-US', options)} – ${this.endDate.toLocaleDateString('en-US', options)}`;
            }

            render() {
                // Update date displays
                document.getElementById('current-dates').textContent = this.formatDateRange();
                document.getElementById('weekly-dates').textContent =
                    `${this.formatDate(this.startDate.toISOString())} – ${this.formatDate(this.endDate.toISOString())}`;

                const container = document.getElementById('categories-container');
                container.innerHTML = '';

                // Render each category that has items
                for (const [categoryName, items] of Object.entries(this.categories)) {
                    if (items.length === 0) continue;

                    const categorySection = this.createCategorySection(categoryName, items);
                    container.appendChild(categorySection);
                }

                if (container.innerHTML === '') {
                    container.innerHTML = '<div class="no-data">No items found for this week.</div>';
                }
            }

            createCategorySection(categoryName, items) {
                const section = document.createElement('section');
                section.className = 'category-section';

                const title = document.createElement('h2');
                title.className = 'category-title';
                title.textContent = categoryName;
                section.appendChild(title);

                const gridContainer = document.createElement('div');

                // Determine grid class based on item count
                const itemCount = items.length;
                if (itemCount <= 3) {
                    gridContainer.className = 'scroll-grid grid-rows-1';
                } else if (itemCount <= 8) {
                    gridContainer.className = 'scroll-grid grid-rows-2';
                } else {
                    gridContainer.className = 'scroll-grid grid-rows-3';
                }

                // Create cards
                items.forEach(item => {
                    const card = this.createCard(item);
                    gridContainer.appendChild(card);
                });

                section.appendChild(gridContainer);
                return section;
            }

            createCard(item) {
                const card = document.createElement('div');
                card.className = 'card';

                const link = item.url || item.href || item.link || item.source_url || '#';

                const title = item.title || item.name || item.headline || 'Untitled';
                const description = item.description || item.summary || item.content || item.text || 'No description available.';

                const collectionDate = new Date(item.collectionDate);
                const dateStr = collectionDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });

                // Extract domain from URL for source
                let source = 'Unknown Source';
                if (item.source && typeof item.source === 'string') {
                    source = item.source;
                } else {
                    try {
                        const url = new URL(link);
                        source = url.hostname.replace('www.', '');
                    } catch {
                        source = 'Unknown Source';
                    }
                }

                card.innerHTML = `
                    <h3 class="card-title">
                        <a href="${link}" target="_blank" rel="noopener noreferrer">${this.escapeHtml(title)}</a>
                    </h3>
                    <p class="card-description">${this.escapeHtml(description)}</p>
                    <div class="card-metadata">
                        <span class="card-date">${dateStr}</span>
                        <span class="card-source">${this.escapeHtml(source)}</span>
                    </div>
                `;

                return card;
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        }

        // Initialize the report when page loads
        document.addEventListener('DOMContentLoaded', () => {
            const generator = new WeeklyReportGenerator();
            generator.init();
        });
    </script>
</body>
</html>